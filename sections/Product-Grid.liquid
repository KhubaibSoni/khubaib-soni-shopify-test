<style>
  .feature-section {
    display: flex;
    justify-content: center;
    padding: 30px 50px;
  }
  .feature-section .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    grid-template-areas:none;
  }
  .feature-section .grid .product-item {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
  }
  .feature-section .grid .product-item img.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .detail-container {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
  }

  .detail-icon {
    height: 28px;
    width: 28px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .detail-icon:hover {
    transform: scale(1.1);
  }

  /* Plus Icon */
  .plus-icon {
    display: block;
  }
  .close-icon {
    display: none;
  }

  /* When popup is active */
  .detail-container.active .plus-icon {
    display: none;
  }
  .detail-container.active .close-icon {
    display: block;
  }

  /* Product Popup Styles */
  .product-popup {
    display: none;
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 10px;
    min-width: 160px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 20;
  }
  .detail-container.active .product-popup {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    cursor: pointer;
  }

  .product-popup .popup-image {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 4px;
    flex-shrink: 0;
  }

  .product-popup .popup-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .product-popup .popup-info .popup-title {
    font-size: 12px;
    font-weight: 600;
    color: #333;
    margin: 0;
    line-height: 1.3;
  }
  .product-popup .popup-info .popup-price {
    font-size: 13px;
    font-weight: 700;
    color: #000;
    margin: 0;
  }

  /* Close button positioned at top right of popup */
  .popup-close-btn {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 20px;
    height: 20px;
    background: #d9d9d9;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: none;
    padding: 0;
  }
  .popup-close-btn svg {
    width: 10px;
    height: 10px;
  }

  /* Add to Cart Modal Overlay */
  .atc-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  .atc-modal-overlay.active {
    display: flex;
  }

  .atc-modal {
    background: #fff;
    width: 90%;
    max-width: 380px;
    border-radius: 4px;
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
  }

  .atc-modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #333;
    z-index: 10;
  }

  .atc-modal-content {
    padding: 20px;
  }

  .atc-product-header {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }

  .atc-product-image {
    width: 100px;
    height: 120px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .atc-product-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .atc-product-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin: 0;
  }

  .atc-product-price {
    font-size: 15px;
    font-weight: 700;
    color: #000;
    margin: 0;
  }

  .atc-product-description {
    font-size: 12px;
    color: #666;
    margin: 0;
    line-height: 1.4;
  }

  .atc-variant-group {
    margin-bottom: 15px;
  }

  .atc-variant-label {
    font-size: 13px;
    color: #333;
    margin-bottom: 8px;
    display: block;
  }

  .atc-variant-options {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .atc-variant-btn {
    padding: 10px 20px;
    border: 1px solid #ddd;
    background: #f5f5f5;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
  }

  .atc-variant-btn:hover {
    border-color: #333;
  }

  .atc-variant-btn.selected {
    background: #333;
    color: #fff;
    border-color: #333;
  }

  .atc-size-select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    font-size: 13px;
    appearance: none;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 15px center;
    cursor: pointer;
  }

  .atc-add-btn {
    width: 100%;
    padding: 15px;
    background: #000;
    color: #fff;
    border: none;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    transition: background 0.2s;
  }

  .atc-add-btn:hover {
    background: #333;
  }

  .atc-add-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }

  .atc-add-btn .arrow {
    font-size: 18px;
  }

  /* Mobile Responsive Styles */
  @media screen and (max-width: 768px) {
    .feature-section {
      padding: 20px 15px;
    }
    .feature-section .grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .detail-icon {
      height: 24px;
      width: 24px;
    }
    .product-popup {
      min-width: 140px;
      padding: 8px;
    }
    .product-popup .popup-image {
      width: 40px;
      height: 40px;
    }
    .product-popup .popup-info .popup-title {
      font-size: 11px;
    }
    .product-popup .popup-info .popup-price {
      font-size: 12px;
    }
    
    /* Modal responsive */
    .atc-modal {
      width: 95%;
      max-width: 340px;
    }
    .atc-modal-content {
      padding: 15px;
    }
    .atc-product-header {
      gap: 12px;
    }
    .atc-product-image {
      width: 80px;
      height: 100px;
    }
    .atc-product-title {
      font-size: 14px;
    }
    .atc-product-price {
      font-size: 14px;
    }
    .atc-product-description {
      font-size: 11px;
    }
    .atc-variant-btn {
      padding: 8px 15px;
      font-size: 12px;
    }
    .atc-size-select {
      padding: 10px 12px;
      font-size: 12px;
    }
    .atc-add-btn {
      padding: 12px;
      font-size: 13px;
    }
  }

  @media screen and (max-width: 480px) {
    .feature-section {
      padding: 15px 10px;
    }
    .feature-section .grid {
      gap: 8px;
    }
    .detail-container {
      bottom: 8px;
    }
    .detail-icon {
      height: 22px;
      width: 22px;
    }
    .product-popup {
      min-width: 120px;
      padding: 6px;
      bottom: 32px;
    }
    .product-popup .popup-image {
      width: 35px;
      height: 35px;
    }
    .product-popup .popup-info .popup-title {
      font-size: 10px;
    }
    .product-popup .popup-info .popup-price {
      font-size: 11px;
    }
    
    /* Modal responsive small screens */
    .atc-modal-content {
      padding: 12px;
    }
    .atc-product-header {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .atc-product-image {
      width: 100px;
      height: 120px;
    }
    .atc-variant-options {
      justify-content: center;
    }
  }
</style>

<div class="feature-section">
  <div class="grid">
    {% if section.settings.feature_products != blank %}
      {% for product in section.settings.feature_products limit: 6 %}
        <div class="product-item">
          <img class="product-image" src="{{ product.featured_image.src | image_url }}" alt="{{ product.title }}" width="300" height="300">

          <div class="detail-container" data-product-id="{{ product.id }}">
            <!-- Plus Icon (default) -->
            <svg
              class="detail-icon plus-icon"
              width="47"
              height="41"
              viewBox="0 0 47 41"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              onclick="toggleProductPopup(this)"
            >
              <ellipse cx="23.5" cy="20.5" rx="23.5" ry="20.5" fill="#D9D9D9"/>
              <path d="M24 12V29.974" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
              <path d="M32.9919 20.9653L15.018 20.9987" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
            </svg>

            <!-- Close Icon (shown when active) -->
            <svg
              class="detail-icon close-icon"
              width="47"
              height="41"
              viewBox="0 0 47 41"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              onclick="toggleProductPopup(this)"
            >
              <ellipse cx="23.5" cy="20.5" rx="23.5" ry="20.5" fill="#D9D9D9"/>
              <path d="M16 13L31 28" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
              <path d="M31 13L16 28" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
            </svg>

            <!-- Product Popup -->
            <div class="product-popup" onclick="openAddToCartModal(this)" 
              data-product-id="{{ product.id }}"
              data-product-handle="{{ product.handle }}"
              data-product-title="{{ product.title }}"
              data-product-price="{{ product.price | money }}"
              data-product-image="{{ product.featured_image.src | image_url }}"
              data-product-description="{{ product.description | strip_html | truncate: 100 }}"
              data-first-variant-id="{{ product.selected_or_first_available_variant.id }}">
              <img class="popup-image" src="{{ product.featured_image.src | image_url }}" alt="{{ product.title }}" width="60" height="60">
              <div class="popup-info">
                <p class="popup-title">{{ product.title }}</p>
                <p class="popup-price">{{ product.price | money }}</p>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}

    {% else %}
      {% for product in collections.all.products limit: 6 %}
        <div class="product-item">
          <img class="product-image" src="{{ product.featured_image.src | image_url }}" alt="{{ product.title }}" width="300" height="300">

          <div class="detail-container" data-product-id="{{ product.id }}">
            <!-- Plus Icon (default) -->
            <svg
              class="detail-icon plus-icon"
              width="47"
              height="41"
              viewBox="0 0 47 41"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              onclick="toggleProductPopup(this)"
            >
              <ellipse cx="23.5" cy="20.5" rx="23.5" ry="20.5" fill="#D9D9D9"/>
              <path d="M24 12V29.974" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
              <path d="M32.9919 20.9653L15.018 20.9987" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
            </svg>

            <!-- Close Icon (shown when active) -->
            <svg
              class="detail-icon close-icon"
              width="47"
              height="41"
              viewBox="0 0 47 41"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              onclick="toggleProductPopup(this)"
            >
              <ellipse cx="23.5" cy="20.5" rx="23.5" ry="20.5" fill="#D9D9D9"/>
              <path d="M16 13L31 28" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
              <path d="M31 13L16 28" stroke="black" stroke-width="3.1863" stroke-linecap="square" stroke-linejoin="round"/>
            </svg>

            <!-- Product Popup -->
            <div class="product-popup" onclick="openAddToCartModal(this)" 
              data-product-id="{{ product.id }}"
              data-product-handle="{{ product.handle }}"
              data-product-title="{{ product.title }}"
              data-product-price="{{ product.price | money }}"
              data-product-image="{{ product.featured_image.src | image_url }}"
              data-product-description="{{ product.description | strip_html | truncate: 100 }}"
              data-first-variant-id="{{ product.selected_or_first_available_variant.id }}">
              <img class="popup-image" src="{{ product.featured_image.src | image_url }}" alt="{{ product.title }}" width="60" height="60">
              <div class="popup-info">
                <p class="popup-title">{{ product.title }}</p>
                <p class="popup-price">{{ product.price | money }}</p>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- Add to Cart Modal -->
<div class="atc-modal-overlay" id="atcModalOverlay" onclick="closeAddToCartModal(event)">
  <div class="atc-modal" onclick="event.stopPropagation()">
    <button class="atc-modal-close" onclick="closeAddToCartModal(event)">&times;</button>
    <div class="atc-modal-content">
      <div class="atc-product-header">
        <img class="atc-product-image" id="atcProductImage" src="" alt="" width="100" height="120">
        <div class="atc-product-info">
          <h3 class="atc-product-title" id="atcProductTitle"></h3>
          <p class="atc-product-price" id="atcProductPrice"></p>
          <p class="atc-product-description" id="atcProductDescription"></p>
        </div>
      </div>
      
      <div id="atcVariantsContainer">
        <!-- Variants will be dynamically inserted here -->
      </div>
      
      <button class="atc-add-btn" id="atcAddBtn" onclick="addToCart()">
        ADD TO CART
        <span class="arrow">â†’</span>
      </button>
    </div>
  </div>
</div>

<script src="{{ 'Product-Grid.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Product Grid",
  "tag": "section",
  "class": "custom-Grid",
  "settings": [
    {
      "type": "product_list",
      "id": "feature_products",
      "limit": 6,
      "label": "Feature Products",
      "info": "Select any 6 products you want to display as featured products"
    }
  ]
}
{% endschema %}
